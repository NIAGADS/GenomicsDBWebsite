#!/usr/bin/env python

"""
extracts urls from model.prop.sample and creates a pipes to stdout a JSON object containing the macro -> value mappings
"""

import argparse
import json

def extract_urls():
    try:
        urlMapping = {}
        with open(args.modelPropFile, 'r') as fh, open(args.outputFile, 'w') as ofh:
            for line in fh:
                if '_URL' in line and not line.startswith('#'):
                    line = line.rstrip()
                    macro, value = line.split('=', 1)
                    urlMapping[macro] = value
            
            print("// WARNING: Do not edit this file directly.  Add or modify URLs in the model.prop.sample file for your project.", file=ofh)
            print("// Then run `python $PROJECT_HOME/GenomicsDBWebsite/Model/bin/generateExternalUrlConstantsJson` to regenerate this file.", file=ofh)
            print("// See the model.prop.sample file for more information.", file=ofh)
            print("export const _externalUrls = " + json.dumps(urlMapping), file=ofh)

    except IOError as e:
        print(e)
        print("Error extracting URLs from model.prop file")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="extact URLs from model.prop.sample and convert to JSON map")
    parser.add_argument('--modelPropFile', help="full path to model.prop.sample file", required=True)
    parser.add_argument('--outputFile', help="full path to output file", required=True)
 
    args = parser.parse_args()

    extract_urls()
